<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Import Users from CSV</h2>
  <%= link_to "Back to Bulk Management", admin_bulk_users_path, class: "btn btn-outline-secondary" %>
</div>

<div class="row">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h5>Upload CSV File</h5>
      </div>
      <div class="card-body">
        <%= form_with url: process_import_admin_bulk_users_path, method: :post, 
                      multipart: true, local: true do |form| %>
          
          <div class="mb-3">
            <%= form.label :csv_file, "Select CSV File", class: "form-label" %>
            <%= form.file_field :csv_file, 
                                accept: ".csv", 
                                class: "form-control", 
                                required: true %>
            <div class="form-text">
              Upload a CSV file with user information. Maximum file size: 10MB
            </div>
          </div>
          
          <div class="alert alert-info">
            <h6>CSV Format Requirements:</h6>
            <ul class="mb-0">
              <li><strong>Required columns:</strong> First Name, Last Name, Email</li>
              <li><strong>Optional columns:</strong> Phone, Company, Role, Text Capable, Password</li>
              <li>Headers are case-insensitive and spaces will be converted to underscores</li>
              <li>Role must be "admin" or "attendee" (defaults to attendee)</li>
              <li>If password is not provided, defaults to "password123"</li>
            </ul>
          </div>
          
          <% if defined?(@import_errors) && @import_errors.any? %>
            <div class="alert alert-danger">
              <h6>Import Errors:</h6>
              <ul class="mb-0">
                <% @import_errors.each do |error| %>
                  <li><%= error %></li>
                <% end %>
              </ul>
            </div>
          <% end %>
          
          <div class="d-grid">
            <%= form.submit "Import Users", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  
  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <h6>Sample CSV Format</h6>
      </div>
      <div class="card-body">
        <pre class="small">First Name,Last Name,Email,Phone,Company,Role,Text Capable
John,Doe,john@company.com,503-555-0123,Acme Corp,attendee,true
Jane,Smith,jane@example.com,503-555-0124,Tech Inc,admin,false
Bob,Johnson,bob@test.com,503-555-0125,Test LLC,attendee,true</pre>
      </div>
    </div>
    
    <div class="card mt-3">
      <div class="card-header">
        <h6>Quick Actions</h6>
      </div>
      <div class="card-body">
        <%= link_to "Download Sample CSV", "#", 
                    class: "btn btn-outline-info btn-sm d-block mb-2",
                    onclick: "downloadSampleCSV(); return false;" %>
        <%= link_to "View All Users", admin_users_path, 
                    class: "btn btn-outline-primary btn-sm d-block" %>
      </div>
    </div>
  </div>
</div>

<script>
function downloadSampleCSV() {
  const csvContent = "First Name,Last Name,Email,Phone,Company,Role,Text Capable\n" +
                     "John,Doe,john@company.com,503-555-0123,Acme Corp,attendee,true\n" +
                     "Jane,Smith,jane@example.com,503-555-0124,Tech Inc,admin,false\n" +
                     "Bob,Johnson,bob@test.com,503-555-0125,Test LLC,attendee,true";
  
  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'sample_users.csv';
  a.click();
  window.URL.revokeObjectURL(url);
}
</script>
