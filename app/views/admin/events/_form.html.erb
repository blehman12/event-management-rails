<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-body">
        <%= form_with(model: [:admin, @event], local: true) do |form| %>
          <% if @event.errors.any? %>
            <div class="alert alert-danger">
              <h4><%= pluralize(@event.errors.count, "error") %> prohibited this event from being saved:</h4>
              <ul class="mb-0">
                <% @event.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <div class="mb-3">
            <%= form.label :name, class: "form-label" %>
            <%= form.text_field :name, class: "form-control", required: true %>
          </div>

          <div class="mb-3">
            <%= form.label :description, class: "form-label" %>
            <%= form.text_area :description, class: "form-control", rows: 3 %>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <%= form.label :venue_id, "Venue", class: "form-label" %>
              <%= form.select :venue_id, options_from_collection_for_select(@venues, :id, :name, @event.venue_id), 
                              { prompt: "Select a venue" }, { class: "form-select", required: true } %>
            </div>
            <div class="col-md-6 mb-3">
              <%= form.label :max_attendees, class: "form-label" %>
              <%= form.number_field :max_attendees, class: "form-control", required: true, min: 1 %>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <%= form.label :event_date, "Event Date", class: "form-label" %>
              <%= form.datetime_local_field :event_date, class: "form-control", required: true %>
            </div>
            <div class="col-md-6 mb-3">
              <%= form.label :rsvp_deadline, "RSVP Deadline", class: "form-label" %>
              <%= form.datetime_local_field :rsvp_deadline, class: "form-control", required: true %>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <%= form.label :start_time, class: "form-label" %>
              <%= form.time_field :start_time, class: "form-control", 
                  value: @event.start_time&.strftime("%H:%M") %>
            </div>
            <div class="col-md-6 mb-3">
              <%= form.label :end_time, class: "form-label" %>
              <%= form.time_field :end_time, class: "form-control", 
                  value: @event.end_time&.strftime("%H:%M") %>
            </div>
          </div>

          <!-- CUSTOM QUESTIONS SECTION - DYNAMIC -->
          <div class="mb-4">
            <label class="form-label fw-bold">Custom RSVP Questions</label>
            <small class="text-muted d-block mb-2">
              Add questions that attendees will answer when they RSVP. 
              Examples: "Any dietary restrictions?", "Will you bring a guest?", "T-shirt size?"
            </small>
            
            <div id="custom-questions-container">
              <% if @event.custom_questions.present? %>
                <% @event.custom_questions.each_with_index do |question, index| %>
                  <div class="custom-question-row mb-2">
                    <div class="input-group">
                      <%= text_field_tag "event[custom_questions][]", question, 
                          class: "form-control", 
                          placeholder: "Enter question (e.g., 'Any dietary restrictions?')" %>
                      <button type="button" class="btn btn-outline-danger remove-question">
                        Remove
                      </button>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>
            
            <button type="button" id="add-question" class="btn btn-outline-primary btn-sm mt-2">
              + Add Question
            </button>
          </div>
          <!-- END CUSTOM QUESTIONS SECTION -->

          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <%= link_to "Cancel", admin_events_path, class: "btn btn-outline-secondary me-md-2" %>
            <%= form.submit class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const container = document.getElementById('custom-questions-container');
  const addButton = document.getElementById('add-question');

  if (addButton && container) {
    // Add new question
    addButton.addEventListener('click', function(e) {
      e.preventDefault();
      
      const questionRow = document.createElement('div');
      questionRow.className = 'custom-question-row mb-2';
      questionRow.innerHTML = 
        '<div class="input-group">' +
          '<input type="text" name="event[custom_questions][]" class="form-control" ' +
                 'placeholder="Enter question (e.g., \'Any dietary restrictions?\')">' +
          '<button type="button" class="btn btn-outline-danger remove-question">Remove</button>' +
        '</div>';
      
      container.appendChild(questionRow);
    });

    // Remove question (using event delegation)
    container.addEventListener('click', function(e) {
      if (e.target.classList.contains('remove-question')) {
        e.target.closest('.custom-question-row').remove();
      }
    });
  }
});
</script>